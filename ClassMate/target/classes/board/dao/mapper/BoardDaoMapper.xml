<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="board.dao.face.BoardDao">
  
	<select id="selectFreeAll" resultType="FreeBoard" parameterType="web.util.Paging">
	    SELECT B.*, U.user_name AS userName
	    FROM (
	        SELECT rownum rnum, F.*
	        FROM (
	            SELECT *
	            FROM free_board
	            ORDER BY free_no ASC
	            <!-- ORDER BY free_no DESC -->
	        ) F
	    ) B
	    JOIN user_info U ON B.user_no = U.user_no
	    WHERE B.rnum BETWEEN #{startNo} AND #{endNo}
	</select>
 
  <select id="freeCntAll" resultType="int">
  	SELECT count(*) FROM free_board
  </select>
    
  
	<select id="selectAnnounceAll" resultType="AnnounceBoard">
	    SELECT A.*, U.user_name AS userName
	    FROM announce_board A
	    JOIN user_info U ON A.user_no = U.user_no
	</select>
	  
	<select id="selectEventAll" resultType="EventBoard">
	    SELECT E.*, U.user_name AS userName
	    FROM event_board E
	    JOIN user_info U ON E.user_no = U.user_no
	</select>
  
  	<select id="writeUserId" resultType="UserInfo" parameterType="String">
  		SELECT * FROM user_info
  		WHERE user_id = #{userId}
  	</select>
  
  	<insert id="insert" parameterType="FreeBoard" useGeneratedKeys="true" keyProperty="freeNo">
  		<selectKey keyProperty="freeNo" resultType="int" order="BEFORE">
  			SELECT freeboard_seq.nextval FROM dual
  		</selectKey>
  		INSERT INTO free_board (free_no, user_no, free_head,free_name,free_content)
  		VALUES (#{freeNo}, #{userNo}, #{freeHead}, #{freeName}, #{freeContent})
  	</insert>
  
  	<insert id="insertFile" parameterType="FreeBoardFile" >
  		INSERT INTO free_board_file (file_no, free_no, origin_name, stored_name)
  		VALUES (freeboard_file_seq.nextval, #{freeNo}, #{originName}, #{storedName})
  	</insert>
  
    <select id="selectFreeBoardNo" resultType="FreeBoard" parameterType="FreeBoard">
        SELECT F.*, U.user_name AS userName
        FROM free_board F
        JOIN user_info U ON F.user_no = U.user_no
        WHERE F.free_no = #{freeNo}
    </select>
  
  	<update id="updateHit" parameterType="FreeBoard">
  	  UPDATE free_board
  		<set>
  			free_hit = free_hit + 1
  		</set>
  		<where>
  		 free_no = #{freeNo}
  		</where>
  	</update>
  	
  	<select id="AttachFreeFile" resultType="FreeBoardFile" parameterType="FreeBoard">
  		SELECT
  			file_no, free_no, origin_name, stored_name
  		FROM free_board_file
  		<where>
  			free_no = #{freeNo}
  		</where>
  	</select>
  
  	<select id="downFreeFileNo" resultType="FreeBoardfile" parameterType="FreeBoardfile">
  		SELECT
  			file_no, free_no, origin_name, stored_name
  		FROM free_board_file 
  		<where>
  			file_no = #{fileNo}
  		</where>
  	</select>
  
  	<delete id="deleteFreeFileBoardNo" parameterType="FreeBoard">
  		DELETE free_board_file
  		<where>
  			free_no = #{freeNo}
  		</where>
  	</delete>
  	
	<delete id="deleteFreeBoardNo" parameterType="FreeBoard">
		DELETE free_board
		<where>
			free_no = #{freeNo}
		</where>
	</delete>
  	
  	<!-- +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  
  	<update id="announceUpdateHit" parameterType="AnnounceBoard">
  	  UPDATE announce_board
  		<set>
  			announce_hit = announce_hit + 1
  		</set>
  		<where>
  		 announce_no = #{announceNo}
  		</where>
  	</update>
  	
 	<select id="selectAnnounceBoardNo" resultType="AnnounceBoard" parameterType="AnnounceBoard">
        SELECT A.*, U.user_name AS userName
        FROM announce_board A
        JOIN user_info U ON A.user_no = U.user_no
        WHERE A.announce_no = #{announceNo}
    </select>
  	
  	<select id="AttachAnnounceFile" resultType="AnnounceBoardFile" parameterType="AnnounceBoard">
  		SELECT
  			file_no, announce_no, origin_name, stored_name
  		FROM announce_board_file
  		<where>
  			announce_no = #{announceNo}
  		</where>
  	</select>
  	
  	<update id="eventUpdateHit" parameterType="EventBoard">
  	  UPDATE event_board
  		<set>
  			event_hit = event_hit + 1
  		</set>
  		<where>
  		 event_no = #{eventNo}
  		</where>
  	</update>
  
	<select id="selectEventBoardNo" resultType="EventBoard" parameterType="EventBoard">
        SELECT A.*, U.user_name AS userName
        FROM event_board A
        JOIN user_info U ON A.user_no = U.user_no
        WHERE A.event_no = #{eventNo}
    </select>
  
  	<select id="AttachEventFile" resultType="EventBoardFile" parameterType="EventBoard">
  		SELECT
  			file_no, event_no, origin_name, stored_name
  		FROM event_board_file
  		<where>
  			event_no = #{eventNo}
  		</where>
  	</select>
  
  
  
  
 </mapper>